events {
    worker_connections 1024;
}

http {
    upstream n8n {
        server n8n:5678;
    }

    upstream grafana {
        server grafana:3000;
    }

    upstream ollama {
        server ollama:11434;
    }

    upstream open-webui {
        server open-webui:8080;
    }

    upstream prometheus {
        server prometheus:9090;
    }

    # n8n ì›Œí¬í”Œë¡œìš° ìë™í™”
    server {
        listen 80;
        server_name n8n.localhost;

        location / {
            proxy_pass http://n8n;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # ì›¹ì†Œì¼“ ì§€ì›
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            
            # íƒ€ì„ì•„ì›ƒ ì„¤ì •
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
        }
    }

    # Grafana ëŒ€ì‹œë³´ë“œ
    server {
        listen 80;
        server_name grafana.localhost;

        location / {
            proxy_pass http://grafana;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # ì›¹ì†Œì¼“ ì§€ì›
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }

    # Ollama API
    server {
        listen 80;
        server_name ollama.localhost;

        location / {
            proxy_pass http://ollama;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # LLM ì‘ë‹µì„ ìœ„í•œ ê¸´ íƒ€ì„ì•„ì›ƒ
            proxy_connect_timeout 600s;
            proxy_send_timeout 600s;
            proxy_read_timeout 600s;
            
            # í° ìš”ì²­ ë³¸ë¬¸ í—ˆìš©
            client_max_body_size 100M;
        }
    }

    # Prometheus (ì„ íƒì )
    server {
        listen 80;
        server_name prometheus.localhost;

        location / {
            proxy_pass http://prometheus;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Open WebUI (ì±„íŒ… ì¸í„°í˜ì´ìŠ¤)
    server {
        listen 80;
        server_name chat.localhost;

        location / {
            proxy_pass http://open-webui;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # ì›¹ì†Œì¼“ ì§€ì›
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            
            # íƒ€ì„ì•„ì›ƒ ì„¤ì •
            proxy_connect_timeout 300s;
            proxy_send_timeout 300s;
            proxy_read_timeout 300s;
        }
    }

    # ê¸°ë³¸ ì„œë²„ (ë©”ì¸ ëœë”©)
    server {
        listen 80 default_server;
        server_name _;

        location / {
            return 200 '
<!DOCTYPE html>
<html>
<head>
    <title>AI Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .service {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>ğŸš€ AI Platform ì„œë¹„ìŠ¤</h1>
    <div class="service">
        <h2>ğŸ’¬ Open WebUI - AI ì±„íŒ…</h2>
        <p><a href="http://chat.localhost">http://chat.localhost</a> ë˜ëŠ” <a href="http://localhost:8080">http://localhost:8080</a></p>
    </div>
    <div class="service">
        <h2>n8n - ì›Œí¬í”Œë¡œìš° ìë™í™”</h2>
        <p><a href="http://n8n.localhost">http://n8n.localhost</a> ë˜ëŠ” <a href="http://localhost:5678">http://localhost:5678</a></p>
    </div>
    <div class="service">
        <h2>Grafana - ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h2>
        <p><a href="http://grafana.localhost">http://grafana.localhost</a> ë˜ëŠ” <a href="http://localhost:3000">http://localhost:3000</a></p>
    </div>
    <div class="service">
        <h2>Ollama - LLM API</h2>
        <p><a href="http://ollama.localhost">http://ollama.localhost</a> ë˜ëŠ” <a href="http://localhost:11434">http://localhost:11434</a></p>
    </div>
    <div class="service">
        <h2>Prometheus - ë©”íŠ¸ë¦­</h2>
        <p><a href="http://prometheus.localhost">http://prometheus.localhost</a> ë˜ëŠ” <a href="http://localhost:9090">http://localhost:9090</a></p>
    </div>
</body>
</html>
            ';
            add_header Content-Type text/html;
        }
    }
}

